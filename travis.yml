language: node_js

node_js:
  - "node"

services:
  - docker

#sudo: false
#before_install:
#  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.13.0
#  - export PATH=$HOME/.yarn/bin:$PATH
#cache:
#  yarn: true

cache: yarn

install:
  - yarn

jobs:
  include:
    - stage: lint
      script: yarn lint
    - stage: test 
      script: yarn test
    - stage: build docker image and push to dockerhub
      script: 
      - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
      - docker build -t travisci-test .
      - docker images
      - docker tag travisci-test $DOCKER_USERNAME/travisci-test
      - docker push $DOCKER_USERNAME/travisci-test
      deploy:
        provider: script
        script: ./deploy.sh
        on:
      branch: master
